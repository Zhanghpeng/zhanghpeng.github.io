---
title: MySQL使用查询缓存
author: roc
date: 2021-06-05 14:10:00 +0800
categories: [Blog, MySQL, MySQL使用查询缓存]
tags: [MySQL, MySQL使用查询缓存]
render_with_liquid: false
---

my.cnf（my.ini）加入以下配置，重启Mysql开启查询缓存

```
query_cache_type=1
query_cache_size=600000
```

Mysql执行以下命令也可以开启查询缓存(配置文件中必须开启缓存)

```
set global  query_cache_type=1;
set global  query_cache_size=600000;
```

如上，**开启查询缓存后在同样的查询条件（区分大小写）以及数据情况下，会直接在缓存中返回结果**。这里的查询条件包括查询本身、当前要查询的数据库、客户端协议版本号等一些可能影响结果的信息。因此任何两个查询在任何字符上的不同都会导致缓存不命中。此外，如果查询中包含任何用户自定义函数、存储函数、用户变量、临时表、Mysql库中的系统表，其查询结果也不会被缓存。

缓存建立之后，Mysql的查询缓存系统会跟踪查询中涉及的每张表，如果这些表（数据或结构）发生变化，那么和这张表相关的所有缓存数据都将失效。

**缓存虽然能够提升数据库的查询性能，但是缓存同时也带来了额外的开销，每次查询后都要做一次缓存操作，失效后还要销毁。** 因此，开启缓存查询要谨慎，尤其对于写密集的应用来说更是如此。如果开启，要注意合理控制缓存空间大小，一般来说其大小设置为几十MB比较合适。此外，**还可以通过sql_cache和sql_no_cache来控制某个查询语句是否需要缓存：**

```mysql
select sql_no_cache count(*) from usr;
```

